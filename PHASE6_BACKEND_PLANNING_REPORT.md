# Phase 6: バックエンド実装計画策定 完了報告書

**作成日**: 2026-01-11
**担当エージェント**: @バックエンド計画オーケストレーター

---

## 📊 分析結果サマリー

### エンドポイント分析
- **総エンドポイント数**: 10エンドポイント
- **垂直スライス数**: 4スライス（スライス1, 2-A, 2-B, 3）
- **並列実装可能グループ**: 2グループ（スライス2-A, 2-B）
- **クリティカルパス数**: 1パス（スライス1 → スライス2-B → スライス3）

### 実装効率化
- **並列実装による短縮**: Week 2で2スライスを同時実装
- **実装順序の最適化**: 依存関係を考慮した論理的順序
- **テーブル競合回避**: 異なるテーブルを操作するスライスを並列化

---

## 📋 垂直スライス実装順序

### スライス1: ストーリー基盤（Week 1）
**優先度**: Critical
**依存関係**: なし
**エンドポイント数**: 3エンドポイント

| エンドポイント | メソッド | 優先度 |
|--------------|---------|--------|
| /api/stories | GET | Critical |
| /api/stories/:id | GET | Critical |
| /api/chapters/:id | GET | High |

**完了基準**: ストーリー一覧表示 → ストーリー選択 → チャプター閲覧 → 分岐選択が可能

---

### スライス2-A: 音声機能（Week 2 - 並列実装）
**優先度**: High
**依存関係**: なし（Google Cloud TTS APIのみ）
**エンドポイント数**: 1エンドポイント

| エンドポイント | メソッド | 優先度 |
|--------------|---------|--------|
| /api/tts/synthesize | POST | High |

**外部API依存**: Google Cloud Text-to-Speech API
**完了基準**: テキストを音声に変換して再生可能

---

### スライス2-B: クイズ基盤（Week 2 - 並列実装）
**優先度**: High
**依存関係**: スライス1（ストーリー基盤）完了後
**エンドポイント数**: 3エンドポイント

| エンドポイント | メソッド | 優先度 |
|--------------|---------|--------|
| /api/quizzes | GET | High |
| /api/quizzes/story/:storyId | GET | High |
| /api/quizzes/answer | POST | High |

**完了基準**: クイズ出題 → 回答 → フィードバック表示が可能

---

### スライス3: 進捗管理（Week 3）
**優先度**: Medium
**依存関係**: スライス2-B（回答履歴が必要）
**エンドポイント数**: 2エンドポイント

| エンドポイント | メソッド | 優先度 |
|--------------|---------|--------|
| /api/progress | GET | Medium |
| /api/progress/graph | GET | Low |

**完了基準**: 正答率表示 → レベル別進捗表示 → グラフ表示が可能

---

## ⏱️ 実装スケジュール

```
Week 1: |====スライス1: ストーリー基盤====|

Week 2: |====スライス2-A: 音声機能====|
        |====スライス2-B: クイズ基盤====|  ← 並列実装

Week 3: |====スライス3: 進捗管理====|
```

**並列実装による短縮効果**:
- 従来の直列実装: 4週間
- 並列実装後: 3週間
- **短縮期間: 1週間（25%の効率化）**

---

## 🎯 クリティカルパス

バックエンド実装において、以下のパスが最も重要です：

1. **スライス1（ストーリー基盤）** - 全機能の前提条件
2. **スライス2-B（クイズ基盤）** - 進捗管理の前提条件
3. **スライス3（進捗管理）** - 最終的な学習体験の完成

**重要**: スライス2-A（音声機能）はクリティカルパス外のため、並列実装可能

---

## 🔗 依存関係マトリックス

### 独立エンドポイント
- `POST /api/tts/synthesize`
  - 依存: なし（Google Cloud TTS APIのみ）
  - 優先度: medium

### 基盤エンドポイント（最優先実装）
- `GET /api/stories`
  - 依存: なし
  - 提供: ストーリー一覧
  - 優先度: critical

- `GET /api/stories/:id`
  - 依存: stories テーブル
  - 提供: ストーリー詳細
  - 優先度: critical

### 連鎖エンドポイント
- `GET /api/chapters/:id`
  - 依存: `GET /api/stories/:id`
  - 優先度: high

- `GET /api/quizzes/story/:storyId`
  - 依存: `GET /api/stories/:id`
  - 優先度: high

- `POST /api/quizzes/answer`
  - 依存: `GET /api/quizzes`
  - 優先度: high

### 集約エンドポイント
- `GET /api/progress`
  - 依存: `POST /api/quizzes/answer`
  - 優先度: medium

- `GET /api/progress/graph`
  - 依存: `GET /api/progress`
  - 優先度: low

---

## 📁 成果物

### 実装計画書
- **保存先**: `docs/SCOPE_PROGRESS.md`（セクション3）
- **内容**:
  - 3.1 垂直スライス実装順序
  - 3.2 エンドポイント実装タスクリスト
  - 3.3 並列実装スケジュール
  - 3.4 依存関係マトリックス
  - 3.5 バックエンド実装への引き継ぎ

### API仕様書（既存）
- `docs/api-specs/story-experience-api.md` - 4エンドポイント
- `docs/api-specs/quiz-progress-api.md` - 6エンドポイント

### 型定義（既存）
- `frontend/src/types/index.ts` - 単一の真実源（225行）

---

## 🚀 次のアクション

### Phase 7: バックエンド実装への引き継ぎ

#### 実装順序の厳守事項
1. **スライス1（ストーリー基盤）を必ず最初に完成させる**
2. **番号-アルファベット表記（2-A, 2-B）は並列実装可能**
3. **スライスの依存関係を確認し、前提条件を満たす**

#### 並列実装時の注意事項
- データベースマイグレーションの競合を避ける
- 共通ユーティリティは最初に作成（エラーハンドリング、DB接続プール）
- 型定義（`frontend/src/types/index.ts` ↔ `backend/src/types/index.ts`）の同期を忘れない

#### テスト作成の重要ポイント
- 各スライス完了時に統合テストを作成
- 並列実装したものは個別にテスト可能に設計
- E2Eテスト仕様書（`docs/api-specs/`内のAPI仕様書）を参照

---

## ✅ Phase 6完了チェックリスト

- [x] API仕様書の収集と分析（10エンドポイント抽出）
- [x] エンドポイント依存関係マトリックスの作成
- [x] 垂直スライスの定義と優先順位付け（4スライス）
- [x] 並列実装可能性の分析（2グループ特定）
- [x] SCOPE_PROGRESS.mdへの実装計画出力
- [x] エンドポイント実装タスクリスト生成
- [x] 並列実装スケジュール作成
- [x] 進捗管理表の更新（60%完了）

---

## 🎯 成功基準達成状況

| 成功基準 | 達成状況 |
|---------|---------|
| 全エンドポイントの依存関係を明確化 | ✅ 完了 |
| 並列実装可能な部分を最大化 | ✅ 完了（Week 2で2スライス並列） |
| 実装順序の論理的根拠を明示 | ✅ 完了（依存関係マトリックス作成） |
| SCOPE_PROGRESS.mdに詳細計画を出力 | ✅ 完了（セクション3追加） |
| テスト戦略の明確化 | ✅ 完了（統合・E2E戦略記載） |

---

**Phase 6完了**: 2026-01-11
**次のPhase**: Phase 7 - バックエンド実装（スライス1から開始）

---

このオーケストレーターにより、効率的で論理的なバックエンド実装計画が策定され、並列実装による開発期間短縮が実現されます。
